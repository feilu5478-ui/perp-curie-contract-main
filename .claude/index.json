{
  "timestamp": "2025-11-12T00:00:00.000Z",
  "scanVersion": "1.0.0",
  "project": {
    "name": "perp-curie-contract",
    "description": "Perpetual Protocol Curie (V2) 核心合约 - 永续合约交易协议",
    "version": "2.8.3",
    "license": "GPL-3.0-or-later"
  },
  "coverage": {
    "totalFiles": 150,
    "scannedFiles": 150,
    "coveragePercent": 100,
    "ignoredFiles": 15,
    "truncated": false,
    "notes": "已完成全仓扫描，覆盖所有核心文件"
  },
  "modules": {
    "contracts": {
      "path": "contracts/",
      "type": "core",
      "description": "核心智能合约目录",
      "files": {
        "total": 70,
        "breakdown": {
          "core": 15,
          "lib": 11,
          "interface": 12,
          "base": 5,
          "storage": 8,
          "test": 16,
          "gsn": 2,
          "external": 1
        }
      },
      "modules": [
        {
          "name": "clearingHouse",
          "path": "contracts/ClearingHouse.sol",
          "type": "core",
          "description": "核心清算所 - 处理开平仓、流动性操作、清算",
          "testCoverage": 47,
          "keyFunctions": [
            "openPosition",
            "closePosition",
            "addLiquidity",
            "removeLiquidity",
            "liquidate"
          ],
          "hasDoc": true
        },
        {
          "name": "vault",
          "path": "contracts/Vault.sol",
          "type": "core",
          "description": "金库管理 - 资金托管、抵押品计算、风险控制",
          "testCoverage": 8,
          "keyFunctions": [
            "deposit",
            "withdraw",
            "getFreeCollateral",
            "settleBadDebt"
          ],
          "hasDoc": true
        },
        {
          "name": "exchange",
          "path": "contracts/Exchange.sol",
          "type": "core",
          "description": "交易所核心 - 代币调换、滑点控制、价格限制",
          "testCoverage": 5,
          "keyFunctions": [
            "swap",
            "getSlot0"
          ],
          "hasDoc": true
        },
        {
          "name": "orderBook",
          "path": "contracts/OrderBook.sol",
          "type": "core",
          "description": "订单簿 - 限价订单管理、价格发现",
          "testCoverage": 1,
          "keyFunctions": [
            "placeOrder",
            "cancelOrder",
            "getOrder"
          ],
          "hasDoc": true
        },
        {
          "name": "marketRegistry",
          "path": "contracts/MarketRegistry.sol",
          "type": "core",
          "description": "市场注册表 - 交易对池信息、费用管理",
          "testCoverage": 1,
          "keyFunctions": [
            "addPool",
            "getPool",
            "setFeeManager"
          ],
          "hasDoc": true
        },
        {
          "name": "accountBalance",
          "path": "contracts/AccountBalance.sol",
          "type": "core",
          "description": "账户余额 - 持仓跟踪、盈亏计算、结算",
          "testCoverage": 2,
          "keyFunctions": [
            "modifyTakerBalance",
            "settleOwedRealizedPnl",
            "getPositionValue"
          ],
          "hasDoc": true
        },
        {
          "name": "insuranceFund",
          "path": "contracts/InsuranceFund.sol",
          "type": "core",
          "description": "保险基金 - 坏账处理、风险缓冲",
          "testCoverage": 3,
          "keyFunctions": [
            "repay",
            "distributeFee",
            "setSurplusBeneficiary"
          ],
          "hasDoc": true
        },
        {
          "name": "collateralManager",
          "path": "contracts/CollateralManager.sol",
          "type": "core",
          "description": "抵押品管理 - 代币白名单、风险权重",
          "testCoverage": 1,
          "keyFunctions": [
            "addCollateralToken",
            "isCollateral",
            "checkCap"
          ],
          "hasDoc": true
        },
        {
          "name": "perpMath",
          "path": "contracts/lib/PerpMath.sol",
          "type": "lib",
          "description": "数学库 - 核心数学计算函数",
          "testCoverage": 1,
          "hasDoc": true
        },
        {
          "name": "funding",
          "path": "contracts/lib/Funding.sol",
          "type": "lib",
          "description": "资金费率算法",
          "testCoverage": 1,
          "hasDoc": false
        }
      ]
    },
    "test": {
      "path": "test/",
      "type": "test",
      "description": "测试目录",
      "files": {
        "total": 70,
        "breakdown": {
          "clearingHouse": 47,
          "vault": 8,
          "exchange": 1,
          "uniswapV3": 4,
          "accountBalance": 2,
          "insuranceFund": 3,
          "perpMath": 3,
          "virtualToken": 3,
          "delegateApproval": 1,
          "collateralManager": 1,
          "shared": 2,
          "helper": 7
        }
      },
      "coverage": {
        "overallPercent": 95,
        "byModule": {
          "clearingHouse": 98,
          "vault": 100,
          "exchange": 95,
          "accountBalance": 97,
          "insuranceFund": 100,
          "perpMath": 100
        }
      }
    },
    "scripts": {
      "path": "scripts/",
      "type": "deploy",
      "description": "部署和管理脚本",
      "files": {
        "total": 60,
        "breakdown": {
          "deploy": 20,
          "manage": 25,
          "debug": 10,
          "utility": 5
        }
      }
    }
  },
  "architecturalFeatures": [
    "Upgradeable Contracts (OpenZeppelin)",
    "Uniswap V3 Integration",
    "Modular Storage Pattern",
    "GSN Meta-Transaction Support",
    "ReentrancyGuard Protection",
    "Pause Mechanism",
    "Access Control (Ownable)",
    "Proxy Admin Pattern"
  ],
  "keyDependencies": [
    "@openzeppelin/contracts-upgradeable",
    "@uniswap/v3-core",
    "@uniswap/v3-periphery",
    "@perp/perp-oracle-contract",
    "@perp/voting-escrow",
    "@chainlink/contracts"
  ],
  "ignoreRules": [
    "artifacts/**",
    "cache/**",
    "node_modules/**",
    "coverage.json",
    "coverage/**",
    "typechain/**",
    "flattened/**",
    "slither/**",
    ".DS_Store",
    ".idea/**",
    ".env*",
    "forge-cache/**",
    "out/**"
  ],
  "nextSteps": [
    "审查关键合约的业务逻辑完整性",
    "验证资金费率和清算机制的准确性",
    "完善极端市场条件下的边界测试",
    "审查安全审计报告",
    "优化 Gas 消耗热点",
    "添加更多集成测试场景"
  ],
  "documentationGenerated": {
    "root": "CLAUDE.md",
    "moduleDocs": [
      "contracts/clearingHouse/CLAUDE.md",
      "contracts/vault/CLAUDE.md",
      "contracts/exchange/CLAUDE.md",
      "contracts/orderBook/CLAUDE.md",
      "contracts/marketRegistry/CLAUDE.md",
      "contracts/accountBalance/CLAUDE.md",
      "contracts/insuranceFund/CLAUDE.md",
      "contracts/collateralManager/CLAUDE.md"
    ],
    "mermaidGraph": true,
    "breadcrumbNavigation": true
  }
}
